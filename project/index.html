<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>StarW1N КЕЙСЫ</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
<style>
  :root { --vh: 1vh; }
  body{ 
    margin:0; 
    background:#0a0f1a; 
    font-family:'Montserrat',sans-serif; 
    height: calc(var(--vh, 1vh) * 100); 
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    overflow-x:hidden;
  }

  /* Логотип */
  .logo-bar{ position:fixed; top:0; left:0; width:100%; padding:2vh 0; display:flex; justify-content:center; background:#0a0f1a; z-index:999; transition:transform .1s,opacity .1s;}
  .logo{ font-weight:900; font-size:6vw; letter-spacing:-0.2vw; transform:skewX(-12deg); user-select:none; }
  .gradient-text{ background:linear-gradient(90deg,#4d9fff,#5d6bff,#904bff); -webkit-background-clip:text; color:transparent;}
  .white1{ color:#fff; }

  /* Кейсы */
  .cases-bar{ position:fixed; top:20vh; left:0; width:100%; display:flex; justify-content:center; gap:4vw; z-index:998; transition:transform .1s,opacity .1s;}
  .case{ width:20vw; max-width:150px; aspect-ratio:5/7; background:#1a1f35; border-radius:1.5vw; display:flex; flex-direction:column; align-items:center; padding:1vw; cursor:pointer;}
  .case img.case-image{ width:100%; height:60%; object-fit:cover; margin-bottom:1vh; border-radius:1vw;}
  .case .case-name{ color:#fff; font-size:3vw; text-align:center; font-weight:700; }

  /* Открытый кейс */
  .case-opened{ position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:90vw; max-width:520px; aspect-ratio:5/6; background:#1a1f35; border-radius:3vw; display:flex; flex-direction:column; align-items:center; padding:5vw; z-index:1000; }
  .case-logo{ position:absolute; top:2vw; left:2vw; cursor:pointer; }
  .case-logo .logo{ font-size:5vw; transform:skewX(-12deg); }

  .open-button{ margin-top:3vh; padding:2vh 5vw; background:#333; color:#fff; border:none; border-radius:2vw; font-size:4vw; cursor:pointer; }
  .open-button:disabled{ opacity:.5; cursor:not-allowed; }

  .items-list{ display:flex; flex-wrap:wrap; justify-content:center; gap:2vw; margin-top:3vh; }
  .item-slot{ width:12vw; max-width:60px; aspect-ratio:1/1.4; display:flex; flex-direction:column; align-items:center; margin:1vw; position:relative; }
  .item-slot img{ width:100%; height:100%; border-radius:1vw; object-fit:cover; }
  .rarity{ position:absolute; bottom:5%; left:50%; transform:translateX(-50%); width:2vw; height:2vw; border-radius:50%; }

  .rarity.white{ background-color:white; }
  .rarity.red{ background-color:red; }

  /* Рулетка */
  .roulette{ width:80vw; max-width:500px; aspect-ratio:5/1; overflow:hidden; border-radius:2vw; margin-top:3vh; background:#000; position:relative; border:2px solid rgba(255,255,255,.04);}
  .roulette::after{ content:""; position:absolute; top:0; bottom:0; left:50%; width:0.8vw; transform:translateX(-50%); background:rgba(255,255,255,.06); pointer-events:none; }
  .roulette-track{ display:flex; position:absolute; left:0; top:0; height:100%; will-change: transform; }
  .roulette-item{ width:20vw; max-width:100px; aspect-ratio:1/1; display:flex; justify-content:center; align-items:center; padding:1vw; box-sizing:border-box; }
  .roulette-item img{ width:100%; height:100%; object-fit:cover; border-radius:1vw; }

  /* Результат */
  .result-block{ margin-top:3vh; display:none; flex-direction:column; align-items:center; }
  .result-title{ color:#fff; font-size:5vw; max-font-size:22px; font-weight:700; text-align:center; }
  .result-actions{ display:flex; gap:3vw; margin-top:2vh; flex-wrap:wrap; justify-content:center; }
  .result-btn{ padding:1.5vh 4vw; border:none; border-radius:2vw; cursor:pointer; font-weight:700; font-size:4vw; max-font-size:16px; }
  .sell{ background:#ff4e4e; color:#fff; }
  .keep{ background:#4eff7a; color:#000; }
</style>
</head>
<body>

<div class="logo-bar" id="logoBar">
  <div class="logo"><span class="gradient-text">StarW</span><span class="white1">1</span><span class="gradient-text">N</span></div>
</div>

<div class="cases-bar" id="casesBar">
  <div class="case" id="freeCase">
    <img class="case-image" src="../IMG/IMG_2086.WEBP" alt="FREE">
    <div class="case-name">FREE</div>
  </div>
</div>

<script>
function setFullHeight() {
    document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
}
window.addEventListener('resize', setFullHeight);
setFullHeight();

const logoBar = document.getElementById("logoBar");
const casesBar = document.getElementById("casesBar");
window.addEventListener("scroll", ()=>{
    let y = Math.min(window.scrollY,200);
    let o = 1 - y/200;
    logoBar.style.transform = `translateY(-${y}px)`;
    logoBar.style.opacity = o;
    casesBar.style.transform = `translateY(-${y}px)`;
    casesBar.style.opacity = o;
});

const FREE_CASE_ITEMS = [
    { name: "Happy Brownie", rarity: "white", img: "../IMG/IMG_2046.WEBP", chance: 99.91 },
    { name: "Red 1", rarity: "red", img: "../IMG/IMG_2043.WEBP", chance: 0.01 },
    { name: "Red 2", rarity: "red", img: "../IMG/IMG_2010.WEBP", chance: 0.01 },
    { name: "Red 3", rarity: "red", img: "../IMG/IMG_2009.WEBP", chance: 0.01 },
    { name: "Red 4", rarity: "red", img: "../IMG/IMG_2008.WEBP", chance: 0.01 },
    { name: "Red 5", rarity: "red", img: "../IMG/IMG_2007.WEBP", chance: 0.01 },
    { name: "Red 6", rarity: "red", img: "../IMG/IMG_2006.WEBP", chance: 0.01 },
    { name: "Red 7", rarity: "red", img: "../IMG/IMG_2005.WEBP", chance: 0.01 },
    { name: "Red 8", rarity: "red", img: "../IMG/IMG_2004.WEBP", chance: 0.01 },
    { name: "Red 9", rarity: "red", img: "../IMG/IMG_2003.WEBP", chance: 0.01 },
];

document.getElementById("freeCase").addEventListener("click", ()=>{
    logoBar.style.display="none";
    casesBar.style.display="none";

    const openCase = document.createElement("div");
    openCase.className = "case-opened";
    openCase.innerHTML = `
      <div class="case-logo" id="backLogo">
        <div class="logo"><span class="gradient-text">StarW</span><span class="white1">1</span><span class="gradient-text">N</span></div>
      </div>
      <div style="color:#fff;font-size:5vw;font-weight:700;margin-top:3vh;text-align:center;">FREE CASE</div>
      <div class="roulette" id="roulette">
        <div class="roulette-track" id="rouletteTrack"></div>
      </div>
      <button class="open-button" id="startOpen">ОТКРЫТЬ</button>
      <div class="items-list" id="itemsList"></div>
      <div class="result-block" id="resultBlock">
        <div class="result-title" id="resultTitle"></div>
        <div class="result-actions">
          <button class="result-btn sell" id="sellBtn">Продать</button>
          <button class="result-btn keep" id="keepBtn">Оставить</button>
        </div>
      </div>
    `;
    document.body.appendChild(openCase);

    document.getElementById("backLogo").addEventListener("click", ()=>{
        openCase.remove();
        logoBar.style.display="flex";
        casesBar.style.display="flex";
    });

    const rouletteTrack = document.getElementById("rouletteTrack");
    const itemsList = document.getElementById("itemsList");
    const startOpen = document.getElementById("startOpen");
    const resultBlock = document.getElementById("resultBlock");
    const resultTitle = document.getElementById("resultTitle");
    const sellBtn = document.getElementById("sellBtn");
    const keepBtn = document.getElementById("keepBtn");
    const rouletteEl = document.getElementById("roulette");

    itemsList.innerHTML = "";
    FREE_CASE_ITEMS.forEach(item=>{
        let slot = document.createElement("div");
        slot.className="item-slot";
        let img = document.createElement("img");
        img.src = item.img;
        let r = document.createElement("div");
        r.className = "rarity " + (item.rarity === "white" ? "white" : "red");
        slot.appendChild(img);
        slot.appendChild(r);
        itemsList.appendChild(slot);
    });

    rouletteTrack.innerHTML = "";
    const repeats = 30;
    const rouletteSequence = [];
    for(let r=0;r<repeats;r++){
        FREE_CASE_ITEMS.forEach(it => rouletteSequence.push(it));
    }
    rouletteSequence.forEach(it=>{
        const d = document.createElement("div");
        d.className = "roulette-item";
        d.innerHTML = `<img src="${it.img}" alt="${it.name}" draggable="false">`;
        rouletteTrack.appendChild(d);
    });

    let isSpinning = false;
    startOpen.addEventListener("click", async ()=>{
        if(isSpinning) return;
        isSpinning = true;
        startOpen.disabled = true;
        resultBlock.style.display = "none";

        const itemWidth = rouletteTrack.querySelector(".roulette-item").getBoundingClientRect().width;
        const visibleWidth = rouletteEl.getBoundingClientRect().width;
        const centerOffsetCorrection = Math.round((visibleWidth - itemWidth)/2);

        const winItem = FREE_CASE_ITEMS.find(i => i.rarity === "white");
        const winBaseIndex = FREE_CASE_ITEMS.indexOf(winItem);

        const baseLoops = 6 + Math.floor(Math.random()*3);
        const finalIndex = baseLoops * FREE_CASE_ITEMS.length + winBaseIndex;
        const finalOffset = finalIndex * itemWidth - centerOffsetCorrection;

        const fastDistance = Math.max(1200, itemWidth * FREE_CASE_ITEMS.length * 4);
        rouletteTrack.style.transition = `transform 2.0s linear`;
        rouletteTrack.style.transform = `translateX(-${fastDistance}px)`;

        setTimeout(()=>{
            rouletteTrack.style.transition = `transform 3.0s cubic-bezier(.05,.6,.15,1)`;
            rouletteTrack.style.transform = `translateX(-${finalOffset}px)`;
        }, 2000);

        setTimeout(()=>{
            resultTitle.textContent = `Тебе выпал: ${winItem.name}`;
            resultBlock.style.display = "flex";
            isSpinning = false;
            startOpen.disabled = false;

            if(winItem.rarity === "white"){
                sellBtn.style.display = "none";
                keepBtn.style.display = "none";

                let okBtn = document.getElementById("okBtn");
                if(!okBtn){
                    okBtn = document.createElement("button");
                    okBtn.className = "result-btn";
                    okBtn.id = "okBtn";
                    okBtn.textContent = "Хорошо";
                    resultBlock.querySelector(".result-actions").appendChild(okBtn);
                }
                okBtn.style.display = "inline-block";
                okBtn.onclick = () => { resultBlock.style.display = "none"; };

            } else {
                sellBtn.style.display = "inline-block";
                keepBtn.style.display = "inline-block";
                const okBtn = document.getElementById("okBtn");
                if(okBtn) okBtn.style.display = "none";

                sellBtn.onclick = ()=> { alert("Предмет продан."); };
                keepBtn.onclick = ()=> { alert("Предмет оставлен."); };
            }
        }, 5200);
    });

});
</script>
</body>
</html>
