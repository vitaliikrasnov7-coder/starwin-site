<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>StarW1N КЕЙСЫ</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap" rel="stylesheet">
<style>
  body{ margin:0; background:#0a0f1a; font-family:'Montserrat',sans-serif; height:200vh; }

  /* Логотип */
  .logo-bar{ position:fixed; top:0; left:0; width:100%; padding:20px 0; display:flex; justify-content:center; background:#0a0f1a; z-index:999; transition:transform .1s,opacity .1s;}
  .logo{ font-weight:900; font-size:60px; letter-spacing:-4px; transform:skewX(-12deg); user-select:none; }
  .gradient-text{ background:linear-gradient(90deg,#4d9fff,#5d6bff,#904bff); -webkit-background-clip:text; color:transparent;}
  .white1{ color:#fff; }

  /* Кейсы */
  .cases-bar{ position:fixed; top:150px; left:0; width:100%; display:flex; justify-content:center; gap:20px; z-index:998; transition:transform .1s,opacity .1s;}
  .case{ width:150px; height:200px; background:#1a1f35; border-radius:15px; display:flex; flex-direction:column; align-items:center; padding:10px; cursor:pointer;}
  .case img.case-image{ width:100%; height:120px; object-fit:cover; margin-bottom:10px;}
  .case .case-name{ color:#fff; font-size:20px; font-weight:700; }

  /* Открытый кейс */
  .case-opened{ position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:520px; background:#1a1f35; border-radius:20px; display:flex; flex-direction:column; align-items:center; padding:25px; z-index:1000; }
  .case-logo{ position:absolute; top:18px; left:18px; cursor:pointer; }
  .case-logo .logo{ font-size:35px; transform:skewX(-12deg); }

  .open-button{ margin-top:16px; padding:12px 26px; background:#333; color:#fff; border:none; border-radius:12px; font-size:17px; cursor:pointer; }
  .open-button:disabled{ opacity:.5; cursor:not-allowed; }

  .items-list{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-top:18px; }
  .item-slot{ width:60px; height:60px; background:#333; border-radius:10px; display:flex; justify-content:center; align-items:center; position:relative; color:#fff; font-size:10px; text-align:center; padding:4px; }
  .rarity{ position:absolute; bottom:5px; left:50%; transform:translateX(-50%); width:10px; height:10px; border-radius:50%; }

  /* Рулетка */
  .roulette{ width:420px; height:130px; overflow:hidden; border-radius:12px; margin-top:16px; background:#000; position:relative; border:2px solid rgba(255,255,255,.04);}
  .roulette::after{ content:""; position:absolute; top:0; bottom:0; left:50%; width:4px; transform:translateX(-50%); background:rgba(255,255,255,.06); pointer-events:none; }
  .roulette-track{ display:flex; position:absolute; left:0; top:0; height:130px; will-change: transform; }
  .roulette-item{ width:140px; height:130px; display:flex; justify-content:center; align-items:center; padding:6px; box-sizing:border-box; }
  .roulette-item img{ width:100%; height:100%; object-fit:cover; border-radius:8px; }

  /* Результат */
  .result-block{ margin-top:18px; display:none; flex-direction:column; align-items:center; }
  .result-title{ color:#fff; font-size:22px; font-weight:700; }
  .result-actions{ display:flex; gap:14px; margin-top:12px; }
  .result-btn{ padding:10px 18px; border:none; border-radius:10px; cursor:pointer; font-weight:700; }
  .sell{ background:#ff4e4e; color:#fff; }
  .keep{ background:#4eff7a; color:#000; }

  .item-slot{ width:60px; height:75px; display:flex; flex-direction:column; align-items:center; margin:5px; position:relative; }
  .item-slot img{ width:60px; height:60px; border-radius:10px; object-fit:cover; }
  .rarity.white{ background-color:white; }
  .rarity.red{ background-color:red; }

</style>
</head>
<body>

<div class="logo-bar" id="logoBar">
  <div class="logo"><span class="gradient-text">StarW</span><span class="white1">1</span><span class="gradient-text">N</span></div>
</div>

<div class="cases-bar" id="casesBar">
  <div class="case" id="freeCase">
    <img class="case-image" src="https://via.placeholder.com/150x120" alt="FREE">
    <div class="case-name">FREE</div>
  </div>
</div>

<script>
/* Анимация шапки при скролле */
const logoBar = document.getElementById("logoBar");
const casesBar = document.getElementById("casesBar");
window.addEventListener("scroll", ()=>{
    let y = Math.min(window.scrollY,200);
    let o = 1 - y/200;
    logoBar.style.transform = `translateY(-${y}px)`;
    logoBar.style.opacity = o;
    casesBar.style.transform = `translateY(-${y}px)`;
    casesBar.style.opacity = o;
});

/* Данные для кейса */
const FREE_CASE_ITEMS = [
    { name: "White 1", rarity: "white", img: "https://via.placeholder.com/80", chance: 99.91 },
    { name: "Red 1", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 2", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 3", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 4", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 5", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 6", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 7", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 8", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
    { name: "Red 9", rarity: "red", img: "https://via.placeholder.com/80", chance: 0.01 },
];

/* Открытие кейса */
document.getElementById("freeCase").addEventListener("click", ()=>{

    logoBar.style.display="none";
    casesBar.style.display="none";

    const openCase = document.createElement("div");
    openCase.className = "case-opened";
    openCase.innerHTML = `
      <div class="case-logo" id="backLogo">
        <div class="logo"><span class="gradient-text">StarW</span><span class="white1">1</span><span class="gradient-text">N</span></div>
      </div>
      <div style="color:#fff;font-size:26px;font-weight:700;margin-top:22px;">FREE CASE</div>
      <div class="roulette" id="roulette">
        <div class="roulette-track" id="rouletteTrack"></div>
      </div>
      <button class="open-button" id="startOpen">ОТКРЫТЬ</button>
      <div class="items-list" id="itemsList"></div>
      <div class="result-block" id="resultBlock">
        <div class="result-title" id="resultTitle"></div>
        <div class="result-actions">
          <button class="result-btn sell" id="sellBtn">Продать</button>
          <button class="result-btn keep" id="keepBtn">Оставить</button>
        </div>
      </div>
    `;
    document.body.appendChild(openCase);

    document.getElementById("backLogo").addEventListener("click", ()=>{
        openCase.remove();
        logoBar.style.display="flex";
        casesBar.style.display="flex";
    });

    /* Генерация предметов */
    const rouletteTrack = document.getElementById("rouletteTrack");
    const itemsList = document.getElementById("itemsList");
    const startOpen = document.getElementById("startOpen");
    const resultBlock = document.getElementById("resultBlock");
    const resultTitle = document.getElementById("resultTitle");
    const sellBtn = document.getElementById("sellBtn");
    const keepBtn = document.getElementById("keepBtn");
    const rouletteEl = document.getElementById("roulette");

    itemsList.innerHTML = "";
    FREE_CASE_ITEMS.forEach(item=>{
        let slot = document.createElement("div");
        slot.className="item-slot";
        let img = document.createElement("img");
        img.src = item.img;
        let r = document.createElement("div");
        r.className = "rarity " + (item.rarity === "white" ? "white" : "red");
        slot.appendChild(img);
        slot.appendChild(r);
        itemsList.appendChild(slot);
    });

    rouletteTrack.innerHTML = "";
    const repeats = 30;
    const rouletteSequence = [];
    for(let r=0;r<repeats;r++){
        FREE_CASE_ITEMS.forEach(it => rouletteSequence.push(it));
    }
    rouletteSequence.forEach(it=>{
        const d = document.createElement("div");
        d.className = "roulette-item";
        d.innerHTML = `<img src="${it.img}" alt="${it.name}" draggable="false">`;
        rouletteTrack.appendChild(d);
    });

    function getItemWidth(){
        const sample = document.querySelector(".roulette-item");
        if(!sample) return 140;
        return Math.round(sample.getBoundingClientRect().width);
    }

    /* Запуск рулетки */
    let isSpinning = false;
    startOpen.addEventListener("click", async ()=>{
        if(isSpinning) return;
        isSpinning = true;
        startOpen.disabled = true;
        resultBlock.style.display = "none";

        const itemWidth = getItemWidth();
        const visibleWidth = rouletteEl.getBoundingClientRect().width;
        const centerOffsetCorrection = Math.round((visibleWidth - itemWidth)/2);

        const winItem = FREE_CASE_ITEMS.find(i => i.rarity === "white");
        const winBaseIndex = FREE_CASE_ITEMS.indexOf(winItem);

        const baseLoops = 6 + Math.floor(Math.random()*3);
        const finalIndex = baseLoops * FREE_CASE_ITEMS.length + winBaseIndex;
        const finalOffset = finalIndex * itemWidth - centerOffsetCorrection;

        const fastDistance = Math.max(1200, itemWidth * FREE_CASE_ITEMS.length * 4);
        rouletteTrack.style.transition = `transform 2.0s linear`;
        rouletteTrack.style.transform = `translateX(-${fastDistance}px)`;

        setTimeout(()=>{
            rouletteTrack.style.transition = `transform 3.0s cubic-bezier(.05,.6,.15,1)`;
            rouletteTrack.style.transform = `translateX(-${finalOffset}px)`;
        }, 2000);

        setTimeout(()=>{
            resultTitle.textContent = `Тебе выпал: ${winItem.name}`;
            resultBlock.style.display = "flex";
            isSpinning = false;
            startOpen.disabled = false;

            if(winItem.rarity === "white"){
                sellBtn.style.display = "none";
                keepBtn.style.display = "none";

                let okBtn = document.getElementById("okBtn");
                if(!okBtn){
                    okBtn = document.createElement("button");
                    okBtn.className = "result-btn";
                    okBtn.id = "okBtn";
                    okBtn.textContent = "Хорошо";
                    resultBlock.querySelector(".result-actions").appendChild(okBtn);
                }
                okBtn.style.display = "inline-block";
                okBtn.onclick = () => { resultBlock.style.display = "none"; };

            } else {
                sellBtn.style.display = "inline-block";
                keepBtn.style.display = "inline-block";
                const okBtn = document.getElementById("okBtn");
                if(okBtn) okBtn.style.display = "none";

                sellBtn.onclick = ()=> { alert("Предмет продан."); };
                keepBtn.onclick = ()=> { alert("Предмет оставлен."); };
            }
        }, 5200);
    });

    /* Анимация кейса при скролле */
    const onScrollCase = ()=> {
        let offset = Math.min(window.scrollY, 300);
        openCase.style.transform = `translate(-50%, calc(-50% - ${offset}px))`;
        openCase.style.opacity = 1 - offset/600;
    };
    window.addEventListener("scroll", onScrollCase);

});
</script>

</body>
</html>
